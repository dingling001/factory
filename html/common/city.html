<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <script src="../../assets/js/fontsize.js"></script>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/api.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1220513_2ea6fr0vbal.css">
</head>
<body>
<div id="app" v-chock>
    <mt-popup
            v-model="popupVisible"
            position="bottom">
        <mt-picker :slots="myAddressSlots" @change="onCityValuesChange" showToolbar value-key="name" :itemHeight="40">
        </mt-picker>
    </mt-popup>
</div>
</body>
</html>
<script type="text/javascript" src="../../assets/js/api.js"></script>
<script type="text/javascript" src="../../assets/js/fastclick.js"></script>
<script>
    new FastClick(document.body);
</script>
<script type="text/javascript" src="../../assets/js/vue.min.js"></script>
<script type="text/javascript" src="../../assets/js/index.js"></script>
<script type="text/javascript" src="../../assets/js/public.js"></script>
<script type="text/javascript"
        src="https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/3.0.0/vconsole.min.js"></script>
<script>
    new VConsole();
</script>
<script>
    window.apiready = function () {
        var app = new Vue({
            el: '#app',
            data: {
                popupVisible: true,
                region: '',//三级地址
                province: '',//省
                city: '',//市
                area: '',//县
                provinceCode: '',//省级代码
                cityCode: '', //市级代码
                areaCode: '',//县级代码
                regionInit: false,//禁止地区选择器自动初始化，picker组件会默认进行初始化，导致一进入页面就会默认选中一个初始3级地址
                myAddressSlots: [//省
                    {
                        flex: 1,
                        values: _getProvinceList(), //省份数组
                        className: 'slot1',
                        textAlign: 'center'
                    },
                    //分隔符
                    {
                        divider: true,
                        content: '-',
                        className: 'slot2'
                    },
                    //市
                    {
                        flex: 1,
                        values: _getCityList('11'),
                        className: 'slot3',
                        textAlign: 'center'
                    },
                    {
                        divider: true,
                        content: '-',
                        className: 'slot4'
                    },
                    //县
                    {
                        flex: 1,
                        values: _getRegionList('1101'),
                        className: 'slot5',
                        textAlign: 'center'
                    }
                ],
            },
            created: function () {
                apiready = function () {
                }
            },
            methods: {
                // 选择地址
                onCityValuesChange(picker, values) {
                    if (app.regionInit) {
                        //取值并赋值
                        // alert(JSON.stringify(values))
                        if (values[0] && values[1] && values[2]) {
                            app.region = values[0]["name"] + values[1]["name"] + values[2]["name"];
                            app.province = values[0]["name"];
                            app.city = values[1]["name"];
                            app.county = values[2]["name"];
                            app.provinceCode = values[0]["code"];
                            app.cityCode = values[1]["code"];
                            app.countyCode = values[2]["code"];
                            // console.log("省:")
                            // console.table(picker.getSlotValues(0));
                            // console.log("省/市/区:")
                            // console.table(picker.getValues());
                            //给市、县赋值
                            if (_getCityList(values[0]["code"]).indexOf(values[0]) > 0 && _getCityList(values[0]["code"]).length > 0) {
                                picker.setSlotValues(1, _getCityList(13));
                            } else {
                            }
                            // picker.setSlotValues(2, _getRegionList(values[1]["code"]));
                        } else {
                            console.log("数据不全");
                            toastMsg('数据不全')
                        }
                    } else {
                        app.regionInit = true;
                    }
                },
                closeCity: function () {
                    api.closeFrame();
                }
            }
        })
    }
</script>
